<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>GFAST: src/core/waveformProcessor/offset.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pnsn_icon.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GFAST
   &#160;<span id="projectnumber">v0.01</span>
   </div>
   <div id="projectbrief">Fast geodetic computations for earthquake early warning</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('offset_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">offset.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="gfast__core_8h_source.html">gfast_core.h</a>&quot;</code><br />
<code>#include &quot;iscl/log/log.h&quot;</code><br />
</div>
<p><a href="offset_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="offset_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(x,  y)&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e75242132eaabbc1c512488a135926"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="offset_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a>(x,  y)&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:a74e75242132eaabbc1c512488a135926"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abdb4263e33ad3749c9b56de37ea91a24"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="offset_8c.html#abdb4263e33ad3749c9b56de37ea91a24">core_waveformProcessor_offset</a> (const int utm_zone, const double svel_window, const double ev_lat, const double ev_lon, const double ev_dep, const double ev_time, struct <a class="el" href="struct_g_f_a_s_t__data__struct.html">GFAST_data_struct</a> gps_data, struct <a class="el" href="struct_g_f_a_s_t__offset_data__struct.html">GFAST_offsetData_struct</a> *offset_data, int *ierr)</td></tr>
<tr class="memdesc:abdb4263e33ad3749c9b56de37ea91a24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates the average offset for each GPS precise point positiion data stream with the additional requirement that the shear wave has passed through through the site.  <a href="#abdb4263e33ad3749c9b56de37ea91a24">More...</a><br /></td></tr>
<tr class="separator:abdb4263e33ad3749c9b56de37ea91a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aacc3ee1a7f283f8ef65cea31f4436a95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="offset_8c_source.html#l00009">9</a> of file <a class="el" href="offset_8c_source.html">offset.c</a>.</p>

</div>
</div>
<a class="anchor" id="a74e75242132eaabbc1c512488a135926"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="offset_8c_source.html#l00012">12</a> of file <a class="el" href="offset_8c_source.html">offset.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="abdb4263e33ad3749c9b56de37ea91a24"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int core_waveformProcessor_offset </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>utm_zone</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>svel_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>ev_lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>ev_lon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>ev_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>ev_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct_g_f_a_s_t__data__struct.html">GFAST_data_struct</a>&#160;</td>
          <td class="paramname"><em>gps_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct_g_f_a_s_t__offset_data__struct.html">GFAST_offsetData_struct</a> *&#160;</td>
          <td class="paramname"><em>offset_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ierr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates the average offset for each GPS precise point positiion data stream with the additional requirement that the shear wave has passed through through the site. </p>
<dl class="section note"><dt>Note</dt><dd>To perform the averaging it is presumed the shear wave has passed through the station then the average offset is estimated from data beginning at the shear wave arrival and ending at the last sample seen at the station. The approximate shear wave arrival time is estimated by presuming a shear wave velocity (svel_window, <img class="formulaInl" alt="$ v_{s} $" src="form_18.png"/>) and an origin time <img class="formulaInl" alt="$ t_{0} $" src="form_19.png"/> then computing the source receiver distance <img class="formulaInl" alt="$ d_{s,r} $" src="form_20.png"/> and applying <img class="formulaInl" alt="$ t_{s} = t_0 + \frac{ d_{s,r} }{ v_{s} } $" src="form_21.png"/>. Because the inversion is for static offsets a conservative strategy to avoid modeling the dynamic response is to lower the shear velocity.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">utm_zone</td><td>if not -12345 then this is the desired UTM zone in which to compute source and receiver positions. otherwise, the UTM zone will be estimated from the source location </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">svel_window</td><td>the shear wave velocity used in data windowing (km/s). if the the site/source distance is less than (current_time - ev_time)*svel_window then the site will be excluded </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ev_lat</td><td>source hypocentral latitude (degrees) [-90,90] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ev_lon</td><td>source hypocentral longitude (degrees) [0,360] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ev_dep</td><td>source hypocentral depth (km) (this is positive down from the free surface) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ev_time</td><td>source origin time in seconds since epoch (UTC) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gps_data</td><td>contains the most up-to-date precise point positions for each site</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">offset_data</td><td>on input holds a logical mask if a site is to be ignored. on output holds the average offset at each site satisfying the S velocity window mask. in this case, all sites with data are given data weights of unity and all sites without data are given weights of zero.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ierr</td><td>0 indicates success</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of sites at which peak displacement was computed</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Brendan Crowell (PNSN) and Ben Baker (ISTI)</dd></dl>
<dl class="section date"><dt>Date</dt><dd>May 2016 </dd></dl>

<p>Definition at line <a class="el" href="offset_8c_source.html#l00080">80</a> of file <a class="el" href="offset_8c_source.html">offset.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_aebb8dcc11953d78e620bbef0b9e2183.html">core</a></li><li class="navelem"><a class="el" href="dir_f72e93501cfc053a34a1167fdbd7bd87.html">waveformProcessor</a></li><li class="navelem"><a class="el" href="offset_8c.html">offset.c</a></li>
    <li class="footer">Generated on Wed Aug 2 2017 12:35:02 for GFAST by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
